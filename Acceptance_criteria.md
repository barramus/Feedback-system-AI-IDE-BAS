# Acceptance Criteria: Функционал обратной связи

## AC-001: Интерфейс оценки ответа
**Связь с требованием:** US-001  
**Версия:** 1.0  **Дата:** 2025-10-15  
**Автор:** Бизнес-аналитик  **Ответственные:** Команда разработки

**Описание:** Система должна предоставлять интерактивный интерфейс для оценки ответа с помощью звезд и комментария.

**Предусловия:**
- Пользователь авторизован в системе
- Получен ответ от системы
- Интерфейс отображает основной контент ответа

**Условия проверки:**
- Блок оценки отображается после основного контента ответа, перед кнопкой «Начать новую задачу»
- Блок содержит текст "оценить ответ" и 5 звезд в неактивном состоянии
- При наведении курсора на звезды подсвечиваются все звезды до текущей
- При клике на звезду фиксируется рейтинг (например, клик на 3-ю звезду → первые 3 звезды активны)
- После выбора рейтинга автоматически появляется блок с полем для комментария
- Поле комментария имеет подпись "не обязательно"
- Блок содержит кнопку «Отправить»
- После успешной отправки блок оценки скрывается
- После успешной отправки показывается сообщение «Спасибо за отзыв!»

**Постусловия:**
- Пользовательский интерфейс обновлен согласно действиям пользователя
- Данные готовы к отправке на бэкенд

**Приоритет:** Критический  
**Обоснование:** Основной пользовательский интерфейс для сбора обратной связи

**Методы и инструменты проверки:**
- Ручное тестирование: проверка интерактивности звезд
- Автоматизация: Selenium для UI тестов
- Визуальная проверка: соответствие макетам

**Критерии успешности:**
- Все элементы интерфейса работают корректно
- Пользовательский опыт соответствует ожиданиям
- Ошибки отображения или взаимодействия — критерии отказа

---

## AC-002: Отправка данных на бэкенд
**Связь с требованием:** US-001  
**Версия:** 1.0  **Дата:** 2025-10-15  
**Автор:** Бизнес-аналитик  **Ответственные:** Команда frontend разработки

**Описание:** Frontend должен корректно отправлять данные отзыва на бэкенд API.

**Предусловия:**
- Пользователь выбрал рейтинг (1-5 звезд)
- Пользователь ввел комментарий (опционально)
- Пользователь нажал кнопку «Отправить»

**Условия проверки:**
- Отправляется POST запрос на эндпоинт `/api/v1/feedback/`
- В заголовке передается токен авторизации
- Тело запроса содержит JSON с полями: rating, comment, session_id
- Рейтинг передается как число от 1 до 5
- Комментарий передается как строка (максимум 1000 символов)
- Session_id передается как строка (опционально)
- При успешной отправке (201 статус) скрывается блок оценки
- При успешной отправке показывается сообщение «Спасибо за отзыв!»
- При ошибке (4XX/5XX статус) показывается понятное сообщение об ошибке

**Постусловия:**
- Данные отправлены на бэкенд
- Пользователь получил обратную связь о результате

**Приоритет:** Критический  
**Обоснование:** Критическая функциональность для сохранения отзывов

**Методы и инструменты проверки:**
- Ручное тестирование: проверка сетевых запросов
- Автоматизация: API тесты
- Инструменты: Postman, браузерные DevTools

**Критерии успешности:**
- Данные корректно передаются на бэкенд
- Обработка ошибок работает корректно
- Неправильный формат данных или ошибки сети — критерии отказа

---

## AC-003: Валидация и сохранение отзыва
**Связь с требованием:** US-003, US-004  
**Версия:** 1.0  **Дата:** 2025-10-15  
**Автор:** Бизнес-аналитик  **Ответственные:** Команда backend разработки

**Описание:** Бэкенд должен валидировать и сохранять отзывы с защитой от спама.

**Предусловия:**
- Получен POST запрос на `/api/v1/feedback/`
- Пользователь авторизован (валидный токен в заголовке)

**Условия проверки:**
- Валидация рейтинга: число от 1 до 5 (включительно)
- Валидация комментария: максимум 1000 символов, опционально
- Валидация session_id: только буквы, цифры, дефисы, подчеркивания
- Санитизация комментария: удаление HTML тегов
- Проверка rate limit: максимум 5 отзывов за 10 минут
- Проверка дублирования: один отзыв на session_id
- Создание уникального UUID для каждого отзыва
- Сохранение в таблицу `feedbacks` с полями: id, user_id, rating, comment, session_id, created_at
- Возврат ответа 201 при успешном сохранении
- Логирование создания отзыва для аудита

**Постусловия:**
- Отзыв сохранен в базе данных
- Записаны логи для аудита
- Пользователь получил подтверждение

**Приоритет:** Высокий  
**Обоснование:** Обеспечение целостности и безопасности данных

**Методы и инструменты проверки:**
- Автоматизация: unit тесты для валидации
- Интеграционные тесты с БД
- Нагрузочное тестирование для rate limit

**Критерии успешности:**
- Все валидации работают корректно
- Данные сохраняются без потерь
- Нарушения валидации или ошибки БД — критерии отказа

---

## AC-004: Административная статистика
**Связь с требованием:** US-002  
**Версия:** 1.0  **Дата:** 2025-10-15  
**Автор:** Бизнес-аналитик  **Ответственные:** Команда backend разработки

**Описание:** Администраторы должны иметь доступ к статистике и аналитике отзывов.

**Предусловия:**
- Администратор авторизован (валидный ADMIN_API_KEY)
- В системе есть сохраненные отзывы

**Условия проверки:**
- GET `/api/v1/feedback/admin/all` возвращает список отзывов
- Поддерживается пагинация через параметры skip и limit
- Поддерживается фильтрация по рейтингу (1-5)
- Поддерживается фильтрация по email пользователя (частичное совпадение)
- Поддерживается фильтрация по дате создания
- Ответ содержит информацию о пользователе (email)
- GET `/api/v1/feedback/admin/stats` возвращает статистику
- Статистика включает: общее количество отзывов, средний рейтинг, распределение по звездам
- Без ADMIN_API_KEY возвращается ошибка 403
- Максимум 100 записей за один запрос

**Постусловия:**
- Администратор получил запрошенные данные
- Система записала лог доступа к админке

**Приоритет:** Средний  
**Обоснование:** Мониторинг качества сервиса и принятие решений

**Методы и инструменты проверки:**
- Ручное тестирование: проверка API через Postman
- Автоматизация: API тесты для админских эндпоинтов
- Тестирование безопасности: проверка доступа без прав

**Критерии успешности:**
- Все эндпоинты работают корректно
- Фильтрация и пагинация работают правильно
- Отсутствие доступа без прав — критерий успеха
- Ошибки при обработке запросов — критерии отказа

---

## AC-005: Обработка ошибок и исключений
**Связь с требованием:** US-003, US-004  
**Версия:** 1.0  **Дата:** 2025-10-15  
**Автор:** Бизнес-аналитик  **Ответственные:** Команда разработки

**Описание:** Система должна корректно обрабатывать все возможные ошибки и исключения.

**Предусловия:**
- Происходит любое взаимодействие с функционалом отзывов

**Условия проверки:**
- При rate limit превышении возвращается ошибка 429 с понятным сообщением
- При дублировании session_id возвращается ошибка 409
- При невалидных данных возвращается ошибка 400/422 с деталями
- При отсутствии авторизации возвращается ошибка 401
- При отсутствии ADMIN_API_KEY возвращается ошибка 403
- При ошибках БД возвращается ошибка 500
- Все ошибки логируются для дальнейшего анализа
- Frontend корректно отображает сообщения об ошибках
- Система продолжает работать после ошибок

**Постусловия:**
- Ошибка корректно обработана и залогирована
- Пользователь получил понятное сообщение
- Система стабильна

**Приоритет:** Высокий  
**Обоснование:** Обеспечение стабильности и пользовательского опыта

**Методы и инструменты проверки:**
- Тестирование негативных сценариев
- Проверка логов ошибок
- Нагрузочное тестирование

**Критерии успешности:**
- Все типы ошибок обрабатываются корректно
- Система не падает при ошибках
- Необработанные исключения или падение системы — критерии отказа
